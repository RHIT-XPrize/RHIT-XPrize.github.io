<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>AI XPrize Architecture</title>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./css/reveal.css"/>

<link rel="stylesheet" href="./css/theme/night.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = './css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">AI XPrize Architecture</h1><p class="date">Created: 2017-11-01 Wed 10:46</p>
</section>

<section>
<section id="slide-org05923f2">
<h2 id="org05923f2">Our Goal</h2>
<ul>
<li>RHIT is participating in the IBM AI XPrize Competition in 2020!</li>
<li>Robot that can understand and react to natural human interaction.</li>
<li>Specifically working with the manipulation of blocks.</li>
<li>Architect a system that can be easily used and extended by future
teams.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgea482ca">
<h2 id="orgea482ca">Core Requirements</h2>
<ul>
<li>Interfaces with ROS-Indigo.</li>
<li>Easy to slot new components in and out in different combinations to
facilitate rapid experimentation and development.</li>
<li>Able to add new components using different languages.</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgae418b1">
<h2 id="orgae418b1">ROS</h2>
<ul>
<li>"Robotic Operating System"</li>
<li>Protocol for arbitrary message transmission between <code>rosnode</code>'s.</li>
<li>Allows communication across languages.</li>
<li><code>rosjava</code> is the Java interface to ROS.</li>

</ul>
</section>
</section>
<section>
<section id="slide-org79ae0b3">
<h2 id="org79ae0b3">UIMA</h2>
<ul>
<li>"Unstructured Information Management Architecture"</li>
<li>Pipeline architecture used for information processing.</li>
<li>Notably used (and significantly improved) in the IBM Watson
project.</li>
<li>Primarily written in Java.
<ul>
<li>Support for other languages, such as C++ exist, but appear to be
deprecated.</li>

</ul></li>

</ul>
</section>
<section id="slide-orgfbfab59">
<h3 id="orgfbfab59">Common Analysis System (CAS)</h3>
<ul>
<li>"Universal" datatype used by all components of UIMA.</li>
<li>Holds some base information with various annotations written on top
of it.</li>
<li>This base information may be either plain document text or arbitrary
binary data.</li>

</ul>
</section>
<section id="slide-orge98aa70">
<h3 id="orge98aa70">Annotators Explanation</h3>
<ul>
<li>Subset of the general term "Analysis Engine (AE)."</li>
<li>Central component in UIMA.</li>
<li>Inputs a CAS object, and adds new annotation objects to it.</li>
<li>Defined by XML Descriptor file.</li>
<li>Classes representing annotation types are auto-generated by UIMA.</li>

</ul>
</section>
<section id="slide-org02a8ebb">
<h3 id="org02a8ebb">Basic Annotator Example</h3>
<div class="org-src-container">

<pre  class="src src-java"><span style="color: #00ced1;">public</span> <span style="color: #00ced1;">class</span> <span style="color: #ff00ff;">MyAnnotator</span> <span style="color: #00ced1;">extends</span> <span style="color: #ff00ff;">JCasAnnotator_ImplBase</span> <span style="color: #9b30ff;">{</span>
    <span style="color: #ffa500;">@Override</span>
    <span style="color: #00ced1;">public</span> <span style="color: #ff00ff;">void</span> <span style="color: #228b22;">process</span><span style="color: #20b2aa;">(</span><span style="color: #ff00ff;">JCas</span> <span style="color: #ffff00;">cas</span><span style="color: #20b2aa;">)</span> <span style="color: #00ced1;">throws</span> <span style="color: #ff00ff;">AnalysisEngineProcessException</span> <span style="color: #20b2aa;">{</span>
        <span style="color: #ff00ff;">String</span> <span style="color: #ffff00;">docText</span> = cas.getDocumentText<span style="color: #00ff00;">()</span>;
        <span style="color: #ff00ff;">int</span> <span style="color: #ffff00;">location</span>;
        <span style="color: #00ced1;">if</span> <span style="color: #00ff00;">(</span><span style="color: #ffff00;">(</span>location = docText.indexOf<span style="color: #ffa500;">(</span><span style="color: #d2691e;">"purple"</span><span style="color: #ffa500;">)</span><span style="color: #ffff00;">)</span> != -1<span style="color: #00ff00;">)</span> <span style="color: #00ff00;">{</span>
            <span style="color: #ff00ff;">Color</span> <span style="color: #ffff00;">color</span> = <span style="color: #00ced1;">new</span> <span style="color: #ff00ff;">Color</span><span style="color: #ffff00;">(</span>cas<span style="color: #ffff00;">)</span>;
            color.setBegin<span style="color: #ffff00;">(</span>location<span style="color: #ffff00;">)</span>;
            color.setEnd<span style="color: #ffff00;">(</span>location + <span style="color: #d2691e;">"purple"</span>.length<span style="color: #ffa500;">()</span><span style="color: #ffff00;">)</span>;
            color.setColorName<span style="color: #ffff00;">(</span><span style="color: #d2691e;">"purple"</span><span style="color: #ffff00;">)</span>;
            color.addToIndexes<span style="color: #ffff00;">(</span>cas<span style="color: #ffff00;">)</span>;
        <span style="color: #00ff00;">}</span>
    <span style="color: #20b2aa;">}</span>
<span style="color: #9b30ff;">}</span>
</pre>
</div>
</section>
<section id="slide-org2e15197">
<h3 id="org2e15197">Aggregate AE's</h3>
<ul>
<li>Allows for chaining multiple annotators together.</li>
<li>Essentially just an XML Descriptor file that orders other XML
Descriptors.</li>

</ul>
</section>
</section>
<section>
<section id="slide-org71595bc">
<h2 id="org71595bc">RoboSherlock</h2>
<ul>
<li>Another project working to marry ROS with UIMA.</li>
<li>Written entirely in C++.
<ul>
<li>As such, it uses the seemingly unsupported C++ UIMA.</li>
<li>While UIMA C++ supports other languages (including Python), that
support is even more out-of-date than the core C++.</li>

</ul></li>
<li>We did take lessons learned from their pipeline design into
consideration when outlining how ours would function.</li>

</ul>
</section>
</section>
<section>
<section id="slide-org39f1108">
<h2 id="org39f1108">Networked UIMA</h2>
<ul>
<li>Our design for making UIMA multi-lingual.</li>
<li>Currently implemented using HTTP.</li>
<li>Could be feasible over different protocols in the future.</li>

</ul>
</section>
<section id="slide-org153e53b">
<h3 id="org153e53b">HTTP UIMA Protocol Description</h3>
<ul>
<li>Serialize CAS object into JSON using built-in UIMA functions.</li>
<li>Send Multipart HTTP request to an external server with the JSON-CAS
and any necessary binary data.</li>
<li>External annotator (acting as a server) receives the request,
processes it, and returns a list of annotations in JSON.</li>

</ul>
</section>
<section id="slide-orgbdbfe95">
<h3 id="orgbdbfe95">Returned Annotation JSON</h3>
<div class="org-src-container">

<pre  class="src src-javascript"><span style="color: #9b30ff;">{</span>
    <span style="color: #d2691e;">"my_string_annotation"</span>: <span style="color: #20b2aa;">[</span>
        <span style="color: #00ff00;">{</span>
            <span style="color: #d2691e;">"begin"</span>: 0,
            <span style="color: #d2691e;">"end"</span>: 3,
            <span style="color: #d2691e;">"my_string_field"</span>: <span style="color: #d2691e;">"bar"</span>
        <span style="color: #00ff00;">}</span>,
        <span style="color: #00ff00;">{</span>
            <span style="color: #d2691e;">"begin"</span>: 5,
            <span style="color: #d2691e;">"end"</span>: 10,
            <span style="color: #d2691e;">"my_string_field"</span>: <span style="color: #d2691e;">"foo"</span>
        <span style="color: #00ff00;">}</span>
    <span style="color: #20b2aa;">]</span>,
    <span style="color: #d2691e;">"my_int_annotation"</span>: <span style="color: #20b2aa;">[</span>
        <span style="color: #00ff00;">{</span>
            <span style="color: #d2691e;">"my_int_field"</span>: 5,
            <span style="color: #d2691e;">"my_other_string_field"</span>: <span style="color: #d2691e;">"foobar"</span>
        <span style="color: #00ff00;">}</span>
    <span style="color: #20b2aa;">]</span>
<span style="color: #9b30ff;">}</span>
</pre>
</div>
</section>
<section id="slide-org2927716">
<h3 id="org2927716">Configuration</h3>
<ul>
<li>External annotators will have their access defined in a global JSON
file, either distributed ahead of time or on some server at a fixed
location.</li>

</ul>
<div class="org-src-container">

<pre  class="src src-javascript"><span style="color: #9b30ff;">{</span>
    <span style="color: #d2691e;">"annotator_name"</span>: <span style="color: #20b2aa;">{</span>
        <span style="color: #d2691e;">"address"</span>: <span style="color: #d2691e;">"123.45.67.89"</span>,
        <span style="color: #d2691e;">"port"</span>: 1234
    <span style="color: #20b2aa;">}</span>,
    <span style="color: #d2691e;">"other_annotator_name"</span>: <span style="color: #20b2aa;">{</span>
        <span style="color: #d2691e;">"address"</span>: <span style="color: #d2691e;">"123.45.67.80"</span>,
        <span style="color: #d2691e;">"port"</span>: 4321
    <span style="color: #20b2aa;">}</span>
<span style="color: #9b30ff;">}</span>
</pre>
</div>
</section>
</section>
<section>
<section id="slide-orgede1d02">
<h2 id="orgede1d02">Resulting Architecture Diagram</h2>

<div class="figure">
<p><img src="architecture.png" alt="architecture.png" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgf212a90">
<h2 id="orgf212a90">Example Use Case</h2>
<ul>
<li>We're going to add an example external annotator written in Python.</li>
<li>There is an existing HTTP Annotator superclass in Python, so we
don't need to worry about implementing the protocol.</li>
<li>We'll be adding an annotator that find bits of text which refer to
colors.</li>

</ul>
</section>
<section id="slide-orgf9fccf4">
<h3 id="orgf9fccf4">Writing the Descriptor File</h3>
<ul>
<li>An Eclipse plugin features a convenient GUI for working with XML
Descriptor files.</li>
<li>One will need only to specify the input types, the output types, and
which Java class represents this descriptor.</li>

</ul>

<div class="figure">
<p><img src="./descriptor_editor.png" alt="descriptor_editor.png" />
</p>
</div>
</section>
<section id="slide-orgc6fea36">
<h3 id="orgc6fea36">Adding to the Aggregate AE</h3>
<ul>
<li>Edit whatever Aggregate AE's Descriptor XML file you wish to add the
Annotator to.</li>
<li>Again, the Eclipse plugin makes this very easy to accomplish.</li>

</ul>

<div class="figure">
<p><img src="./aggregate_editor.png" alt="aggregate_editor.png" />
</p>
</div>
</section>
<section id="slide-org05d57f6">
<h3 id="org05d57f6">Writing the Java Code</h3>
<ul>
<li>Goal to necessitate as little Java code as possible when writing an
external annotator.</li>

</ul>
<div class="org-src-container">

<pre  class="src src-java"><span style="color: #00ced1;">public</span> <span style="color: #00ced1;">class</span> <span style="color: #ff00ff;">ColorsAnnotator</span> <span style="color: #00ced1;">extends</span> <span style="color: #ff00ff;">HttpAnnotator</span> <span style="color: #9b30ff;">{</span>
    <span style="color: #ffa500;">@Override</span>
    <span style="color: #00ced1;">protected</span> <span style="color: #ff00ff;">Class</span><span style="color: #20b2aa;">&lt;</span>? <span style="color: #00ced1;">extends</span> <span style="color: #ff00ff;">Annotation</span><span style="color: #20b2aa;">&gt;</span> <span style="color: #228b22;">getAnnotationClass</span><span style="color: #20b2aa;">(</span><span style="color: #ff00ff;">String</span> <span style="color: #ffff00;">name</span><span style="color: #20b2aa;">)</span>
            <span style="color: #00ced1;">throws</span> <span style="color: #ff00ff;">NoMatchingAnnotationException</span> <span style="color: #20b2aa;">{</span>
        <span style="color: #00ced1;">if</span> <span style="color: #00ff00;">(</span>name.equals<span style="color: #ffff00;">(</span><span style="color: #d2691e;">"Color"</span><span style="color: #ffff00;">)</span><span style="color: #00ff00;">)</span>
            <span style="color: #00ced1;">return</span> Color.<span style="color: #00ced1;">class</span>;
        <span style="color: #00ced1;">throw</span> <span style="color: #00ced1;">new</span> <span style="color: #ff00ff;">NoMatchingAnnotationException</span><span style="color: #00ff00;">()</span>;
    <span style="color: #20b2aa;">}</span>
<span style="color: #9b30ff;">}</span>
</pre>
</div>
<ul>
<li>Superclass auto-magically parses primitives into Annotations.</li>
<li>Subclass can always override method to implement custom behavior.</li>

</ul>
</section>
<section id="slide-orgc648a20">
<h3 id="orgc648a20">Writing the Python Annotation</h3>
<ul>
<li>UIMA auto-generates the Annotation classes for Java, but we have to
do so manually in other languages.</li>
<li>The two types must agree in terms of field names and types, as well
as the name of the Annotation itself.</li>

</ul>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #00ced1;">class</span> <span style="color: #ff00ff;">Color</span><span style="color: #9b30ff;">(</span>Annotation<span style="color: #9b30ff;">)</span>:
    <span style="color: #00ced1;">def</span> <span style="color: #228b22;">__init__</span><span style="color: #9b30ff;">(</span><span style="color: #00ced1;">self</span>, color, start, end<span style="color: #9b30ff;">)</span>:
        <span style="color: #00ced1;">self</span>.color = color
        <span style="color: #00ced1;">self</span>.begin = start
        <span style="color: #00ced1;">self</span>.end = end
</pre>
</div>
</section>
<section id="slide-orgdd993f2">
<h3 id="orgdd993f2">Writing the Python Annotator</h3>
<ul>
<li>There's an existing implementation of our protocol in Python, so we
simply extend it.</li>

</ul>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #00ced1;">class</span> <span style="color: #ff00ff;">ColorAnnotator</span><span style="color: #9b30ff;">(</span>Annotator<span style="color: #9b30ff;">)</span>:
    <span style="color: #00ced1;">def</span> <span style="color: #228b22;">initialize</span><span style="color: #9b30ff;">(</span><span style="color: #00ced1;">self</span><span style="color: #9b30ff;">)</span>:
        <span style="color: #00ff00;">super</span><span style="color: #9b30ff;">()</span>.initialize<span style="color: #9b30ff;">()</span>
        <span style="color: #00ced1;">self</span>.color_words = <span style="color: #9b30ff;">[</span><span style="color: #d2691e;">'red'</span>, <span style="color: #d2691e;">'blue'</span>, <span style="color: #d2691e;">'yellow'</span><span style="color: #9b30ff;">]</span>
        <span style="color: #00ced1;">self</span>.annotation_types.append<span style="color: #9b30ff;">(</span>Color<span style="color: #9b30ff;">)</span>

    <span style="color: #00ced1;">def</span> <span style="color: #228b22;">process</span><span style="color: #9b30ff;">(</span><span style="color: #00ced1;">self</span>, data<span style="color: #9b30ff;">)</span>:
        <span style="color: #ffff00;">sofa_string</span> = data<span style="color: #9b30ff;">[</span><span style="color: #d2691e;">'_referenced_fss'</span><span style="color: #9b30ff;">][</span><span style="color: #d2691e;">'1'</span><span style="color: #9b30ff;">][</span><span style="color: #d2691e;">'sofaString'</span><span style="color: #9b30ff;">]</span>
        <span style="color: #00ced1;">for</span> word <span style="color: #00ced1;">in</span> <span style="color: #00ced1;">self</span>.color_words:
            <span style="color: #00ced1;">if</span> word <span style="color: #00ced1;">in</span> sofa_string:
                <span style="color: #00ced1;">self</span>.add_annotation<span style="color: #9b30ff;">(</span>Color<span style="color: #20b2aa;">(</span>word, -1, -1<span style="color: #20b2aa;">)</span><span style="color: #9b30ff;">)</span>
</pre>
</div>
</section>
<section id="slide-orgab55553">
<h3 id="orgab55553">Additional Configuration</h3>
<ul>
<li>Add a new entry into the global configuration JSON file that lists
the address and port this external annotator can be located.</li>

</ul>
</section>
<section id="slide-org762081f">
<h3 id="org762081f">Running</h3>
<ul>
<li>Document text to be analyzed is hard-coded into <code>Controller</code> for
demonstration purposes.</li>

</ul>
<div class="org-src-container">

<pre  class="src src-bash">python ColorAnnotator.py &amp;

roscore &amp;
rosrun edu_rosehulman_aixprize pipeline <span style="color: #d2691e;">\</span>
       edu.rosehulman.aixprize.pipeline.core.Controller
</pre>
</div>
</section>
</section>
<section>
<section id="slide-orge9bdab7">
<h2 id="orge9bdab7">Questions?</h2>
</section>
</section>
</div>
</div>
<script src="./lib/js/head.min.js"></script>
<script src="./js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: './plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: './plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
